name: Maintenance

on:
  schedule:
    - cron: "0 16 * * 0"   # Weekly: Sunday 7:00 PM KSA (UTC+3)
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Safe update (add/modify only)
        run: |
          # Use the original source as upstream (same URL used during Import)
          git remote add upstream "$(git remote get-url origin)" || true
          git fetch upstream || true

          # Switch to main (or master)
          git checkout main || git checkout master

          # Merge updates without committing deletions
          git merge upstream/$(git branch --show-current) --no-commit || true

          # Revert any deletions (protect local files)
          git restore --staged .
          git checkout -- .
 
          # Commit only if there are changes
          git commit -m "chore: maintenance" || true
          git push origin HEAD
