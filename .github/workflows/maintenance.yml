name: Maintenance

on:
  schedule:
    - cron: "0 16 * * 0"   # Sunday 7:00 PM KSA
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure upstream
        run: |
          # ⚠️ ضع رابط المستودع الأصلي هنا (المصدر)
          git remote add upstream https://github.com/ORIGINAL_OWNER/ORIGINAL_REPO.git || true
          git fetch upstream

      - name: Update safely (add & modify only)
        run: |
          git checkout main

          # جلب الفرق بدون تطبيق مباشر
          git diff --name-status HEAD upstream/main > /tmp/diff.txt

          # تطبيق الإضافات والتعديلات فقط
          awk '$1 != "D" { print $2 }' /tmp/diff.txt | xargs -r git checkout upstream/main --

          # تأكيد وجود تغييرات
          if git status --porcelain | grep .; then
            git add .
            git commit -m "chore: maintenance update"
            git push origin main
          else
            echo "No changes to apply"
          fi
